{% load static %}
<!DOCTYPE html>
<html lang="es">
    <head>
        <meta charset="UTF-8">
        <title>Question and Answer System</title>
        <!-- Enlace al archivo CSS externo -->
        <link rel="stylesheet" href="{% static 'styles/question.css' %}">
        <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
        <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.3.1/dist/css/bootstrap.min.css" integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous">
    </head>
    <body>
        <header>
            <h1>Question and Answer System</h1>
        </header>
        <main>
            <section>
                <h2>Make a question</h2>
                <!-- Formulario de ingreso de pregunta -->
                <form action="#" method="post">
                    {% csrf_token %}
                    <input type="text"
                           placeholder="Write your question here"
                           name="question"
                           autocomplete="off"
                           required>
                    <button type="submit">Send</button>
                </form>
            </section>
        </main>
        <div class="answer-content">
        </div>
        <footer>
            <p>© 2023 Question and Answer System</p>
            <!-- Enlaces a políticas del sitio, redes sociales, etc. -->
        </footer>
        <script>
        $(document).ready(function(){
            $("form").on('submit', function(event){
                event.preventDefault();
                var question = $(this).find('input[name="question"]').val();
                var csrfToken = $('input[name="csrfmiddlewaretoken"]').val(); // Obtener el valor del token CSRF
    
                $.ajax({
                    url: './', // Reemplaza esto con la URL de tu endpoint
                    type: 'POST',
                    data: {
                        'question': question,
                        'csrfmiddlewaretoken': csrfToken  // Incluir el token CSRF en los datos enviados
                    },
                    success: function(response){
                        answer = response.answer
                        urls = response.urls
                        answer = answer.substring(1, answer.length - 1);
                        // Expresión regular para encontrar representaciones Unicode
                        const regex = /\\u([\d\w]{4})/gi;
                        // Reemplazar todas las instancias de representaciones Unicode por emojis
                        answer = answer.replace(regex, (_, grupoCapturado) =>
                            String.fromCodePoint(parseInt(grupoCapturado, 16))
                        );
                        var newDiv = $('<div class="answer"></div>');
                        const formattedText = answer.replaceAll('\\n', '<br>');
                        var newParagraph = $('<p></p>').html(formattedText);
                        newDiv.append(newParagraph); // Agregar el párrafo al div
                        // Agregar el nuevo div al body
                        $('.answer-content').append(newDiv);

                        var divLinks = $('<div class="links"></div>');
                        for (let i = 0; i < urls.length; i++) {
                            const url = urls[i];
                            var button = $('<a></a>').attr('href', url).attr('target', '_blank').addClass('btn btn-primary').text('Enlace ' + (i + 1));

                            // Agregar el enlace a la tarjeta
                            divLinks.append(button);
                        }
                        newDiv.append(divLinks)
                    },
                    error: function(error){
                        console.log(error);
                    }
                });
            });
        });
        </script>
    </body>
</html>
